#!/usr/bin/perl -w

use esmith::Build::CreateLinks  qw(:all);

event_templates($_,
		'/etc/dnsmasq.conf',
		'/etc/ethers',
		'/etc/hosts',
		'/etc/resolv.conf') foreach (qw(
  nethserver-dnsmasq-update
  nethserver-dnsmasq-uninstall
));


# conf BEFORE expand templates, to read db default values - Refs #1059
event_actions('nethserver-dnsmasq-update',
	      'initialize-default-databases' => '00',
	      'nethserver-dnsmasq-conf' => '02',
	      'firewall-adjust' => '30',
	      'runlevel-adjust' => '40');

event_services('nethserver-dnsmasq-update',
	       'dnsmasq' => 'restart');

event_actions('nethserver-dnsmasq-uninstall',
	      'nethserver-dnsmasq-uninstall' => '02',
	      'firewall-adjust' => '40',
	      'runlevel-adjust' => '50');



foreach (qw(
    host-create 
    host-delete 
    host-modify 
)) {
    event_templates($_,
		    '/etc/ethers',
		    '/etc/hosts');

    event_services($_, 
		   'dnsmasq' => 'reload');
}

#--------------------------------------------------
# actions for dhcp-reservation validator
#--------------------------------------------------
my $validator = 'dhcp-reservation';
validator_link("ip-not-reserved-local", $validator, "20");


#--------------------------------------------------
# nethserver-dnsmasq-save event
#--------------------------------------------------
event_templates('nethserver-dnsmasq-save',
		'/etc/dnsmasq.conf');
event_services('nethserver-dnsmasq-save',
	       'dnsmasq' => 'restart');

